"""Configuration management for edge worker"""
import os
from pathlib import Path
from dotenv import load_dotenv

# Load .env file from parent directory
env_path = Path(__file__).parent.parent.parent / ".env"
load_dotenv(dotenv_path=env_path)


def env(name: str, default: str = "") -> str:
    """Get environment variable with default value"""
    return os.getenv(name, default)


# Mode configuration
MODE = env("EDGE_MODE", "fake").lower()
CAMERA_ID = int(env("EDGE_CAMERA_ID", "1"))

# Timing configuration
POST_INTERVAL = int(env("EDGE_POST_INTERVAL_SECONDS", "3"))
CONFIG_REFRESH = int(env("EDGE_CONFIG_REFRESH_SECONDS", "30"))

# Stream configuration
EDGE_STREAM_URL = env("EDGE_STREAM_URL", "").strip()
EDGE_STREAM_PORT = int(env("EDGE_STREAM_PORT", "5000"))

# YOLOv5 configuration
CONF_TH = float(env("YOLOV5_CONF", "0.35"))
IOU_TH = float(env("YOLOV5_IOU", "0.45"))
IMG_SIZE = int(env("YOLOV5_IMG_SIZE", "640"))
# Device: "cpu", "cuda", "xpu" (Intel GPU), or "auto" (auto-detect)
DEVICE = env("YOLOV5_DEVICE", "auto")
WEIGHTS = env("YOLOV5_WEIGHTS", "").strip()
REPO = env("YOLOV5_REPO", "").strip()

# Tracking configuration
TRACK_MAX_DISAPPEARED = int(env("TRACK_MAX_DISAPPEARED", "20"))
TRACK_MAX_DISTANCE = float(env("TRACK_MAX_DISTANCE", "80"))

# Backend API configuration
BACKEND_URL = env("BACKEND_URL", "http://localhost:8000")
INGEST_URL = f"{BACKEND_URL}/api/events/ingest"
AUTH_USER = env("EDGE_AUTH_USERNAME", "admin")
AUTH_PASS = env("EDGE_AUTH_PASSWORD", "admin123")
